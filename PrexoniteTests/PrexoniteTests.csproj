<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <IsTestProject>true</IsTestProject>
    <TargetFramework>netcoreapp2.2</TargetFramework>
    <LangVersion>7.3</LangVersion>
  </PropertyGroup>

  <PropertyGroup>
    <SignAssembly>true</SignAssembly>
    <AssemblyOriginatorKeyFile>Prexonite.snk</AssemblyOriginatorKeyFile>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\Prexonite\Prexonite.csproj" />
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.2.0" />
    <PackageReference Include="Moq" Version="4.12.0" />
    <PackageReference Include="NUnit" Version="3.12.0" />
    <PackageReference Include="NUnit3TestAdapter" Version="3.13.0" />
    <DotNetCliToolReference Include="T5.TextTransform.Tool" Version="1.1.0" />
  </ItemGroup>

  <ItemGroup>
    <!-- These files might not exist initially, so we track the by hand. 
         To make this compatible with the implicit Compile rule, we have to remove the items first, 
         otherwise, the tool will complain about duplicate items. -->
    <Compile Remove="Tests\Configurations\PsrUnitTests.cs" />
    <Compile Remove="Tests\Configurations\VMTestConfigurations.cs" />
    <Compile Include="Tests\Configurations\PsrUnitTests.cs" />
    <Compile Include="Tests\Configurations\VMTestConfigurations.cs" />
  </ItemGroup>
  
  <ItemGroup>
    <TextTemplate Include="**\*.tt" />
  </ItemGroup>
  
  <!-- Text Template -->
  <Target Name="TextTemplateTransform" BeforeTargets="BeforeBuild">
    <!-- https://notquitepure.info/2018/12/12/T4-Templates-at-Build-Time-With-Dotnet-Core/ -->
    <Exec WorkingDirectory="$(ProjectDir)" Command="dotnet tt %(TextTemplate.Identity)" />
  </Target>

  <Target Name="TextTemplateClean" AfterTargets="Clean">
    <Delete Files="@(Generated)" />
  </Target>

</Project>
